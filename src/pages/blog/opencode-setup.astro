---
import Base from '../../layouts/Base.astro';
import Steps from '../../components/Steps.astro';
import Tabs from '../../components/Tabs.astro';
import TabItem from '../../components/TabItem.astro';
import Aside from '../../components/Aside.astro';
import Code from '../../components/Code.astro';
---

<Base title="OpenCode Setup" description="Open Source Agentic CLI mit flexibler Model-Auswahl">
  <article class="setup-page">
    <div class="setup-container">
      <header class="page-header">
        <a href="/blog" class="back-link">&larr; Alle Artikel</a>
        <h1>OpenCode Setup</h1>
        <p class="subtitle">Open Source Agentic CLI mit flexibler Model-Auswahl</p>
      </header>

      <section class="content">
        <h2>Was ist OpenCode?</h2>
        <p>
          <strong>OpenCode</strong> ist ein <strong>Open Source</strong> Agentic CLI Tool, das AI direkt in dein Terminal bringt.
          Im Gegensatz zu Claude Code, das nur mit Claude-Modellen funktioniert, kann OpenCode mit <strong>verschiedenen AI-Modellen</strong> arbeiten:
        </p>
        <ul>
          <li><strong>Multi-Model Support</strong> - Claude, GPT, Gemini, lokale Modelle und mehr</li>
          <li><strong>Flexible Provider</strong> - Konfiguriere mehrere AI-Backends gleichzeitig</li>
          <li><strong>Open Source</strong> - Transparenter Code, Community-getrieben</li>
          <li><strong>Direkte Dateizugriffe</strong> - Liest und versteht deinen Code</li>
        </ul>

        <Aside type="tip" title="Warum OpenCode?">
          <p>OpenCode bietet die gleichen Vorteile wie Claude Code (Terminal-Integration, Dateizugriff, Agentic Workflows), aber mit der Freiheit, verschiedene AI-Modelle zu nutzen. Perfekt, wenn du flexibel bleiben willst.</p>
        </Aside>

        <hr />

        <h2>Schritt 1: NMT AI Gateway Zugang</h2>
        <p>Wir nutzen das <strong>firmeninterne AI Gateway</strong> - kein eigenes AI-Abo nötig.</p>

        <Steps>
          <ol>
            <li>
              <strong>Registrierungsseite öffnen</strong>
              <p>Geh auf: <a href="https://tools.ai.tech.as-nmt.de/tools?tool=NMT%2520AI%2520Gateway&tab=getAccess" target="_blank" rel="noopener">NMT AI Gateway Registration</a></p>
            </li>
            <li>
              <strong>Für AI Gateway registrieren</strong>
              <p>Folge den Anweisungen. Du bekommst einen <strong>API Key</strong> - eine lange Zeichenkette wie ein Passwort.</p>
            </li>
            <li>
              <strong>API Key sicher aufbewahren</strong>
              <p>Kopiere den Key und speichere ihn sicher (z.B. Passwort-Manager). Du brauchst ihn in Schritt 3.</p>
            </li>
          </ol>
        </Steps>

        <Aside type="caution" title="Wichtig: Netzwerk">
          <p>Das AI Gateway funktioniert <strong>nur</strong> im Axel Springer Netzwerk (Büro oder VPN)!</p>
        </Aside>

        <hr />

        <h2>Schritt 2: OpenCode installieren</h2>
        <p>Die Installationsanleitung findest du auf der offiziellen OpenCode-Seite:</p>
        <p>
          <a href="https://opencode.ai" target="_blank" rel="noopener" class="install-link">
            opencode.ai &rarr;
          </a>
        </p>

        <Tabs items={["Mac / Linux", "Windows"]}>
          <TabItem label="Mac / Linux" active>
            <p><strong>Option A: npm</strong></p>
            <Code code="npm install -g opencode" />

            <p><strong>Option B: curl</strong></p>
            <Code code="curl -fsSL https://opencode.ai/install.sh | bash" />

            <p>Danach Terminal neu starten und prüfen:</p>
            <Code code="opencode --version" />
          </TabItem>

          <TabItem label="Windows">
            <p>In PowerShell:</p>
            <Code code="npm install -g opencode" lang="powershell" />

            <p>Danach PowerShell neu starten und prüfen:</p>
            <Code code="opencode --version" lang="powershell" />
          </TabItem>
        </Tabs>

        <hr />

        <h2>Schritt 3: API Key als Umgebungsvariable setzen</h2>
        <p>Der API Key wird als Umgebungsvariable gespeichert, damit OpenCode ihn nutzen kann:</p>

        <Tabs items={["Mac / Linux (zsh)", "Mac / Linux (bash)", "Windows"]}>
          <TabItem label="Mac / Linux (zsh)" active>
            <p>Führe diesen Befehl aus (ersetze <code>dein-api-key-hier</code> mit deinem Key):</p>
            <Code
              code={`echo 'export NMT_LITELLM_KEY="dein-api-key-hier"' >> ~/.zshrc && source ~/.zshrc`}
            />
          </TabItem>

          <TabItem label="Mac / Linux (bash)">
            <p>Führe diesen Befehl aus (ersetze <code>dein-api-key-hier</code> mit deinem Key):</p>
            <Code
              code={`echo 'export NMT_LITELLM_KEY="dein-api-key-hier"' >> ~/.bashrc && source ~/.bashrc`}
            />
          </TabItem>

          <TabItem label="Windows">
            <p>In PowerShell:</p>
            <Code
              code={`$env:NMT_LITELLM_KEY = 'dein-api-key-hier'`}
              lang="powershell"
            />
            <p>Für permanente Einrichtung: Suche "Umgebungsvariablen" in Windows.</p>
          </TabItem>
        </Tabs>

        <Aside type="caution">
          <p><strong>API Key geheim halten!</strong> Niemals in Git oder öffentlich teilen.</p>
        </Aside>

        <hr />

        <h2>Schritt 4: OpenCode konfigurieren</h2>
        <p>Erstelle eine <code>opencode.json</code> Datei im Root deines Projekts oder in deinem Home-Verzeichnis:</p>

        <Code
          code={`{
  "$schema": "https://opencode.ai/config.json",
  "provider": {
    "nmt": {
      "npm": "@ai-sdk/openai-compatible",
      "options": {
        "baseURL": "https://litellm.dev.tech.as-nmt.de/v1",
        "apiKey": "{env:NMT_LITELLM_KEY}"
      },
      "models": {
        "eu.anthropic.claude-sonnet-4-5-20250929-v1:0": {
          "name": "NMT Claude Sonnet 4.5"
        }
      }
    }
  }
}`}
          lang="json"
          title="opencode.json"
        />

        <Aside type="note" title="Config-Erklärung">
          <ul>
            <li><code>provider.nmt</code> - Definiert das NMT Gateway als Provider</li>
            <li><code>npm</code> - Nutzt das Vercel AI SDK für OpenAI-kompatible APIs</li>
            <li><code>baseURL</code> - Die NMT Gateway URL</li>
            <li><code>{`{env:NMT_LITELLM_KEY}`}</code> - Liest den API Key aus der Umgebungsvariable</li>
            <li><code>models</code> - Verfügbare Modelle mit Anzeigenamen</li>
          </ul>
        </Aside>

        <hr />

        <h2>Schritt 5: Testen</h2>

        <Steps>
          <ol>
            <li>
              <strong>Navigiere zu einem Ordner</strong>
              <Code code="cd pfad/zu/projekt" />
            </li>
            <li>
              <strong>Starte OpenCode</strong>
              <Code code="opencode" />
            </li>
            <li>
              <strong>Stelle eine Test-Frage</strong>
              <p><em>"Was siehst du in diesem Ordner?"</em></p>
            </li>
            <li>
              <strong>Beenden</strong>
              <p>Tippe <code>/exit</code> oder drücke <code>Ctrl+C</code></p>
            </li>
          </ol>
        </Steps>

        <hr />

        <h2>Checkliste</h2>
        <ul class="checklist">
          <li>NMT AI Gateway Zugang - Du hast einen API Key</li>
          <li><code>opencode --version</code> zeigt eine Versionsnummer</li>
          <li><code>NMT_LITELLM_KEY</code> ist als Umgebungsvariable gesetzt</li>
          <li><code>opencode.json</code> ist erstellt und konfiguriert</li>
          <li>Test-Frage wurde beantwortet</li>
        </ul>

        <hr />

        <h2>Probleme?</h2>
        <p>
          Melde dich bei: <a href="mailto:oladayo.fagbemi@axelspringer.com">oladayo.fagbemi@axelspringer.com</a>
        </p>

        <Aside type="note">
          <p>Falls etwas nicht klappt, schreib mir vor dem Workshop. Wir kriegen das hin! Im Notfall machen wir das Setup gemeinsam in den ersten Minuten.</p>
        </Aside>
      </section>
    </div>
  </article>
</Base>

<style is:global>
  .setup-page {
    padding: 4rem 1.5rem;
  }

  .setup-container {
    max-width: 900px;
    margin: 0 auto;
  }

  .setup-page .page-header {
    margin-bottom: 4rem;
  }

  .setup-page .back-link {
    display: inline-block;
    font-size: 0.875rem;
    color: #878787;
    margin-bottom: 2rem;
    text-decoration: none;
  }

  .setup-page .back-link:hover {
    color: #e5e5e5;
  }

  .setup-page .page-header h1 {
    font-size: 2.5rem;
    font-weight: 600;
    color: #e5e5e5;
    margin-bottom: 0.5rem;
    letter-spacing: -0.02em;
  }

  .setup-page .subtitle {
    font-size: 1.125rem;
    color: #878787;
    margin: 0;
  }

  .setup-page .content h2 {
    font-size: 1.5rem;
    font-weight: 600;
    color: #e5e5e5;
    margin-top: 2rem;
    margin-bottom: 1rem;
  }

  .setup-page .content p {
    color: #a3a3a3;
    line-height: 1.7;
    margin-bottom: 1rem;
  }

  .setup-page .content ul,
  .setup-page .content ol {
    color: #a3a3a3;
    padding-left: 1.5rem;
    margin-bottom: 1rem;
  }

  .setup-page .content li {
    margin-bottom: 0.5rem;
    line-height: 1.6;
  }

  .setup-page .content a {
    color: #60a5fa;
  }

  .setup-page .content a:hover {
    color: #93c5fd;
  }

  .setup-page .install-link {
    display: inline-block;
    padding: 0.75rem 1.5rem;
    background: #1a1a2e;
    border: 1px solid #2a2a4a;
    border-radius: 8px;
    font-weight: 500;
    transition: all 0.2s ease;
  }

  .setup-page .install-link:hover {
    background: #2a2a4a;
    border-color: #60a5fa;
  }

  .setup-page .content hr {
    border: none;
    height: 1px;
    background: #2a2a2a;
    margin: 2.5rem 0;
  }

  .setup-page .content code {
    font-family: 'Geist Mono', monospace;
    font-size: 0.875rem;
    background: #1a1a1a;
    padding: 0.2em 0.4em;
    border-radius: 4px;
  }

  .setup-page .checklist {
    list-style: none;
    padding-left: 0;
  }

  .setup-page .checklist li {
    padding-left: 1.75rem;
    position: relative;
  }

  .setup-page .checklist li::before {
    content: "[ ]";
    position: absolute;
    left: 0;
    color: #60a5fa;
    font-family: 'Geist Mono', monospace;
  }
</style>
