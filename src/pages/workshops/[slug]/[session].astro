---
import Base from '../../../layouts/Base.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const workshops = await getCollection('workshops');
  const sessions = await getCollection('sessions');

  return sessions.map((session) => {
    const workshop = workshops.find((w) => w.id === session.data.workshop);

    return {
      params: { slug: session.data.workshop, session: session.id },
      props: { session, workshop },
    };
  });
}

const { session, workshop } = Astro.props;
const { Content } = await render(session);
---

<Base title={session.data.title} description={session.data.description}>
  <section class="page">
    <div class="container">
      <nav class="breadcrumb">
        <a href="/workshops">Workshops</a>
        <span class="separator">/</span>
        <a href={`/workshops/${workshop.id}`}>{workshop.data.title}</a>
        <span class="separator">/</span>
        <span class="current">{session.data.title}</span>
      </nav>

      <header class="session-header">
        <div class="session-meta">
          <span class="session-number">Session {session.data.order}</span>
          <time class="session-date">
            {session.data.date.toLocaleDateString('de-DE', { day: 'numeric', month: 'long', year: 'numeric' })}
          </time>
          {session.data.duration && <span class="session-duration">{session.data.duration}</span>}
        </div>
        <h1>{session.data.title}</h1>
        <p class="session-description">{session.data.description}</p>

        {session.data.slidesUrl && (
          <a href={session.data.slidesUrl} class="slides-button">
            Slides ansehen
          </a>
        )}
      </header>

      <article class="session-content">
        <Content />
      </article>
    </div>
  </section>
</Base>

<style>
  .page {
    padding: var(--space-12) 0 var(--space-20);
  }

  .breadcrumb {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    margin-bottom: var(--space-8);
  }

  .breadcrumb a {
    color: var(--color-text-muted);
  }

  .breadcrumb a:hover {
    color: var(--color-accent);
  }

  .breadcrumb .separator {
    opacity: 0.5;
  }

  .breadcrumb .current {
    color: var(--color-text-secondary);
  }

  .session-header {
    max-width: 640px;
    margin-bottom: var(--space-12);
  }

  .session-meta {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    margin-bottom: var(--space-4);
  }

  .session-number {
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: var(--tracking-wider);
    color: var(--color-accent);
    padding: var(--space-1) var(--space-2);
    background: var(--color-accent-subtle);
    border-radius: 2px;
  }

  .session-date {
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
  }

  .session-duration {
    font-size: var(--text-sm);
    color: var(--color-text-muted);
  }

  .session-duration::before {
    content: '\2022';
    margin-right: var(--space-2);
  }

  .session-header h1 {
    font-size: var(--text-4xl);
    font-weight: 500;
    letter-spacing: -0.02em;
    margin-bottom: var(--space-4);
  }

  .session-description {
    font-size: var(--text-lg);
    color: var(--color-text-secondary);
    line-height: var(--leading-relaxed);
    margin-bottom: var(--space-6);
  }

  .slides-button {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--color-accent);
    padding: var(--space-2) var(--space-4);
    border: 1px solid var(--color-accent);
    border-radius: 2px;
  }

  .slides-button:hover {
    background: var(--color-accent);
    color: var(--color-bg);
  }

  .slides-button::after {
    content: '\2192';
  }

  .session-content {
    max-width: 640px;
    padding-top: var(--space-8);
    border-top: 1px solid var(--color-border-subtle);
  }

  .session-content :global(h2) {
    font-size: var(--text-xl);
    font-weight: 600;
    margin-top: var(--space-8);
    margin-bottom: var(--space-4);
  }

  .session-content :global(h3) {
    font-size: var(--text-lg);
    font-weight: 600;
    margin-top: var(--space-6);
    margin-bottom: var(--space-3);
  }

  .session-content :global(p) {
    font-size: var(--text-base);
    color: var(--color-text-secondary);
    line-height: var(--leading-relaxed);
    margin-bottom: var(--space-4);
  }

  .session-content :global(ul),
  .session-content :global(ol) {
    margin-bottom: var(--space-4);
    padding-left: var(--space-6);
  }

  .session-content :global(li) {
    font-size: var(--text-base);
    color: var(--color-text-secondary);
    line-height: var(--leading-relaxed);
    margin-bottom: var(--space-2);
  }

  .session-content :global(a) {
    color: var(--color-accent);
  }

  .session-content :global(a:hover) {
    text-decoration: underline;
  }

  .session-content :global(strong) {
    font-weight: 600;
    color: var(--color-text);
  }

  .session-content :global(code) {
    font-family: var(--font-mono);
    font-size: 0.9em;
    padding: 0.15em 0.3em;
    background: var(--color-bg-subtle);
    border-radius: 2px;
  }

  @media (max-width: 640px) {
    .breadcrumb {
      flex-wrap: wrap;
    }

    .session-meta {
      flex-wrap: wrap;
    }
  }
</style>
