---
import { getCollection } from 'astro:content';
import { marked } from 'marked';
import SlideLayout from '../../layouts/SlideLayout.astro';

export async function getStaticPaths() {
	const slides = await getCollection('slides');

	return slides.map((entry) => ({
		params: { slug: entry.id },
		props: { entry },
	}));
}

const { entry } = Astro.props;

// Parse markdown into sections (split by ---)
const rawContent = entry.body || '';
const sections = rawContent.split(/\n---\n/).filter((s) => s.trim());

// Convert each section's markdown to HTML
const parsedSections = await Promise.all(
	sections.map(async (section) => {
		const html = await marked.parse(section.trim());

		return html;
	})
);
---

<SlideLayout title={entry.data.title} description={entry.data.description} theme={entry.data.theme}>
	{parsedSections.map((html) => (
		<section set:html={html} />
	))}
</SlideLayout>
